name: IPTV to Direct Link (Final Fix)

on:
  workflow_dispatch:

jobs:
  convert_and_upload:
    runs-on: ubuntu-latest
    steps:
      - name: Install Tools
        run: sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: Capture 1 Minute
        run: |
          ffmpeg -reconnect 1 -reconnect_at_eof 1 -reconnect_streamed 1 \
          -i "http://front-main.eagle-4k.me:80/live/imadfr_551967/4fWxfRqg/269.ts" \
          -t 60 -c copy test_video.mp4

      - name: Upload to BashUpload
        run: |
          echo "--------------------------------------------------"
          # الرفع مع التمويه لتجاوز الحظر
          curl -L -A "Mozilla/5.0" https://bashupload.com/test_video.mp4 --data-binary @test_video.mp4 > result.txt
          
          echo "✅ تم الرفع! انسخ الرابط أدناه:"
          grep -o 'https://bashupload.com/[^ ]*' result.txt | head -n 1
          echo "--------------------------------------------------"
          
