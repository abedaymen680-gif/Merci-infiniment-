name: IPTV to Direct Link (Stable Version)

on:
  workflow_dispatch:

jobs:
  convert_and_upload:
    runs-on: ubuntu-latest
    steps:
      - name: Install Tools
        run: sudo apt-get update && sudo apt-get install -y ffmpeg jq

      - name: Capture 1 Minute
        run: |
          # Ø³Ø­Ø¨ Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ù€ MP4
          ffmpeg -reconnect 1 -reconnect_at_eof 1 -reconnect_streamed 1 -reconnect_delay_max 5 \
          -i "http://front-main.eagle-4k.me:80/live/imadfr_551967/4fWxfRqg/269.ts" \
          -t 60 -c copy test_video.mp4

      - name: Upload to File.io
        run: |
          # Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·
          RESPONSE=$(curl -s -F "file=@test_video.mp4" https://file.io)
          
          # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©
          LINK=$(echo $RESPONSE | jq -r '.link')
          
          echo "--------------------------------------------------"
          echo "âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!"
          echo "ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©:"
          echo "$LINK"
          echo "--------------------------------------------------"
          echo "Ù†ØµÙŠØ­Ø©: Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ù…Ù†Ø´ÙˆØ± (Ø£Ù†Ø§ ÙÙ‚Ø·) Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¬Ø§Ù†Ø§Ù‹."
          
